<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/master.css">
        <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
        <script language="javascript" src="js/script.js"></script>
        <title>minesweeper</title>
    </head>
    <body>
        <div class="main">
            <div class="header">
                <p class="title">マインスイーパー</p>
                <p class="button"><button type="button" class="btn">?</button></p>
            </div>
            <div class="body">
                <div class="setup">
                    <div class="level">
                        <p>Level</p>
                        <select name="select_level" id="level">
                            <option>easy</option>
                            <option>normal</option>
                            <option>hard</option>
                            <option>customize</option>
                        </select>
                    </div>
                    <div class="customize">
                        <div class="customize_parts">
                            <p>Pixels</p>
                            <p class="textbox">
                                <input type="number" id="custom_x" disabled value="10" min="4" max="50">
                                <span> × </span>
                                <input type="number" id="custom_y" disabled value="10" min="4" max="50">
                            </p>
                        </div>
                        <div class="customize_parts">
                            <p>Bomb</p>
                            <p class="textbox"><input type="number" id="custom_b" disabled value="15" min="1" max="2250"></p>
                        </div>
                        <div class="customize_parts">
                            <p>size</p>
                            <p class="textbox"><input type="range" class="range" id="custom_s" disabled value="90"></p>
                        </div>
                    </div>
                </div>
                <div class="main_panel">
                    <div class="minesweeper">
                        <div class="header">
                            <p class="time" id='time'>Time 00:00</p>
                            <p class="bomb_img"><img src="../_common/img/cell_bomb.png" alt="bomb" width="30px"></p>
                            <p class="bomb" id="bomb"> × 15</p>
                            <p class="button"><button type="button" class="btn">×</button></p>
                        </div>
                        <div class="minesweeper_main">
                            <table id="minesweeper_main"></table>
                        </div>
                    </div>
                    <div class="result">
                        <p class="text">Game Clear</p>
                        <p class="time">Time 00:00</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <!--<script type="text/javascript" src="js/script.js"></script>
    <script>
        'use strict';
        var x = 10, y = 10, bomb = 15, size = 50;
        var startTime, timerId;

        //initialize html
        var ms;
        init(x, y, bomb, size);

        //read data(select level)
        const level = document.getElementById('level')
        level.onchange = function(){
            var custom_x = document.getElementById('custom_x');
            var custom_y = document.getElementById('custom_y');
            var custom_b = document.getElementById('custom_b');
            var custom_s = document.getElementById('custom_s');

            custom_x.disabled = custom_y.disabled = custom_b.disabled = custom_s.disabled = true;
            switch(level.value){
                case 'easy':
                    x = y = 10;
                    bomb = 15;
                    size = 45;
                    break;
                case 'normal':
                    x = 20;
                    y = 15;
                    bomb = 45;
                    size = 30;
                    break;
                case 'hard':
                    x = 30;
                    y = 20;
                    bomb = 120;
                    size = 25;
                    break;
                case 'customize':
                    custom_x.disabled = custom_y.disabled = custom_b.disabled = custom_s.disabled = false;
                    break;
            }
            custom_x.value = x;
            custom_y.value = y;
            custom_b.value = bomb;
            custom_s.value = size*2;

            init(x, y, bomb, size);
        };

        //read data(customize)
        document.getElementById('custom_x').onchange = function(){
            x = document.getElementById('custom_x').value;
            init(x, y, bomb, size);
        };
        document.getElementById('custom_y').onchange = function(){
            y = document.getElementById('custom_y').value;
            init(x, y, bomb, size);
        };
        document.getElementById('custom_b').onchange = function(){
            bomb = document.getElementById('custom_b').value;
            init(x, y, bomb, size);
        };
        document.getElementById('custom_s').onchange = function(){
            size = document.getElementById('custom_s').value/2;
            init(x, y, bomb, size);
        };

        //setup minesweeper
        function init(x, y, bomb, size){
            ms = new Minesweeper(x, y, bomb, 'minesweeper_main');
            ms.setSize(size);
            initTimer();
            setCell();
        }

        function archives(){//マスのクリック時の処理のアーカイブ。現在はsetCell関数を使用している。
            ms.cells.forEach(function(item, index){
                document.getElementById(item.id).onclick = function(){
                    if(ms.setBomb === false){
                        ms.initBomb(index%ms.x, Math.floor(index/ms.x));
                    }
                    ms.open(index%ms.x, Math.floor(index/ms.x));
                }
            });
        }

        function setCell(){
            ms.cells.forEach(function(item, index){
                const cell = document.getElementById(item.id);
                //右クリックでメニューが表示されないように、右クリックを無効化
                cell.addEventListener('contextmenu', function(e){
                        e.preventDefault();
                }, false);
                //マウスクリック時の処理(e.buttonの0が左クリック、2が右クリック)
                cell.addEventListener('mousedown', function(e){
                    switch(e.button){
                        case 0:
                            if(ms.setBomb === false){
                                ms.initBomb(index%ms.x, Math.floor(index/ms.x));
                                startTime = new Date();
                                countUp();
                            }
                            ms.open(index%ms.x, Math.floor(index/ms.x));
                            break;
                        case 2:
                            if(ms.setBomb === true){
                                ms.marking(index%ms.x, Math.floor(index/ms.x));
                                document.getElementById('bomb').textContent = ` × ${ms.rest()}`;
                            }
                            break;
                    }
                        /*document.getElementById('rest_bomb').textContent = ': '+String(minesweeper.rest());
                        //console.log('gameover:'+minesweeper.isGameOver()+' gameclear:'+minesweeper.isGameClear())
                        if(minesweeper.isGameOver() === true){
                            console.log('gameover');
                            document.getElementById('js-popup').classList.toggle('is-show');
                            popupImage();
                            clearTimeout(timer_id);
                        }else if(minesweeper.isGameClear() === true){
                            console.log('clear');
                            document.getElementById('js-popup').classList.toggle('is-show');
                            popupImage();
                            clearTimeout(timer_id);
                        }*/
                }, false);
            });
        }

        function initTimer(){
            clearTimeout(timerId);
            document.getElementById('time').textContent = 'Time 00:00';
        }
        function countUp(){
            timerId = setTimeout(function(){
                var time = Math.floor((new Date().getTime() - startTime.getTime()) / 1000);
                var min = Math.floor(time/60);
                var sec = time%60;
                document.getElementById('time').textContent = `Time ${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
                countUp();
            }, 1000);
        }

    </script>
</html>

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../_common/css/master.css">
        <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
        <script language="javascript" src="../_common/js/script.js"></script>
        <title>minesweeper</title>
    </head>
    <body>
        <header><script>header();</script></header>

        <div class="popup" id="js-popup">
            <div class="popup-inner">
                <div class="close-btn" id="js-close-btn"><i class="fas fa-times"></i></div>
                <p id='res_text'>Game Over</p>
                <p id='res_cleartime'>aaaaaa</p>
                <div class='res_button'>
                    <button type='button' id='newgame'>あたらしく始める</button>
                    <button type='button' id='replay'>同じ配置で始める</button>
                </div>
            </div>
            <div class="black-background" id="js-black-bg"></div>
        </div>

        <div id='header'>
            <h3>作品タイトル：マインスイーパー</h3>
        </div>
        <main>
            <div id='data'>
                <p id='bomb'><img src='../_common/img/cell_bomb.png' width="36px"><span id='rest_bomb'>: 15</span></p>
                <p id='time'>Time 00:00</p>
            </div>
            <script>
                //マインスイーパーのセットアップ。サイズとバクダンの数を設定。
                const x = 10, y = 10, bomb = 15;
                var minesweeper = new Minesweeper(x, y, bomb);
                //※引数は画像のサイズのパーセンテージ
                minesweeper.init(45);

                //test1_1(minesweeper);
                //test1_2(minesweeper);

                //右クリックされたらマーキング、左クリックされたらマスを開く
                minesweeper.cells.forEach(function(item, index){
                    const cell = document.getElementById(item.imgId);
                    console.log();
                    cell.addEventListener('contextmenu', function(e){
                        e.preventDefault();
                    }, false);
                    cell.addEventListener('mousedown', function(e){
                        switch(e.button){
                            case 0:
                                if(minesweeper.setBomb === false){
                                    timer(new Date());
                                }
                                minesweeper.open(index);
                                break;
                            case 2:
                                if(minesweeper.setBomb === true)
                                    minesweeper.marking(index);
                                break;
                        }
                        document.getElementById('rest_bomb').textContent = ': '+String(minesweeper.rest());
                        //console.log('gameover:'+minesweeper.isGameOver()+' gameclear:'+minesweeper.isGameClear())
                        if(minesweeper.isGameOver() === true){
                            console.log('gameover');
                            document.getElementById('js-popup').classList.toggle('is-show');
                            popupImage();
                            clearTimeout(timer_id);
                        }else if(minesweeper.isGameClear() === true){
                            console.log('clear');
                            document.getElementById('js-popup').classList.toggle('is-show');
                            popupImage();
                            clearTimeout(timer_id);
                        }
                    }, false);
                });

                document.getElementById('newgame').onclick = function(){
                    minesweeper = new Minesweeper(x, y, bomb);
                    for(var i = 0; i < minesweeper.x*minesweeper.y; i++){
                        document.getElementById(minesweeper.cells[i].imgId).src = '../_common/img/cell.png';
                    }
                };
                
                //左クリックされたらマスを開く
                /*minesweeper.cells.forEach(function(item, index){
                    document.getElementById(item.imgId).onclick = function(){
                        minesweeper.open(index);
                    };
                });*/

            </script>
        </main>
        <div id='introduce'>
            <h4>作品紹介</h4>
            <p>comming soon</p>
        </div>
        <footer><script>footer();</script></footer>
    </body>
</html>